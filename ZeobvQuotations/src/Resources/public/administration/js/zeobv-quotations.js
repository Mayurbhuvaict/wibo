!function(e){var t={};function n(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(o,a,function(t){return e[t]}.bind(null,a));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/bundles/zeobvquotations/",n(n.s="/3fB")}({"/3fB":function(e,t,n){"use strict";n.r(t);var o=n("UN1d"),a=n.n(o);function r(e,t,n,o,a,r,i){try{var s=e[r](i),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(o,a)}var i=Shopware.Component,s=Shopware.Data.Criteria;i.extend("zeobv-quotations-list","sw-order-list",{template:a.a,methods:{getList:function(){var e,t=this;return(e=regeneratorRuntime.mark((function e(){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.isLoading=!0,e.next=3,Shopware.Service("filterService").mergeWithStoredFilters(t.storeKey,t.orderCriteria);case 3:return n=e.sent,t.activeFilterNumber=n.filters.length,n.addAssociation("zeobvQuote.stateMachineState"),n.addFilter(s.not("and",[s.equals("order.zeobvQuote.id",null)])),e.prev=7,e.next=10,t.orderRepository.search(n);case 10:o=e.sent,t.total=o.total,t.orders=o,t.isLoading=!1,e.next=19;break;case 16:e.prev=16,e.t0=e.catch(7),t.isLoading=!1;case 19:case"end":return e.stop()}}),e,null,[[7,16]])})),function(){var t=this,n=arguments;return new Promise((function(o,a){var i=e.apply(t,n);function s(e){r(i,o,a,s,l,"next",e)}function l(e){r(i,o,a,s,l,"throw",e)}s(void 0)}))})()},getOrderColumns:function(){return[{property:"extensions.zeobvQuote.quoteNumber",label:"zeobv-quotations.list.columnQuoteNumber",routerLink:"zeo.quotations.detail",allowResize:!0,primary:!0},{property:"salesChannel.name",label:"sw-order.list.columnSalesChannel",allowResize:!0},{property:"orderCustomer.firstName",dataIndex:"orderCustomer.lastName,orderCustomer.firstName",label:"sw-order.list.columnCustomerName",allowResize:!0},{property:"extensions.zeobvQuote.stateMachineState.name",label:"zeobv-quotations.list.columnState",allowResize:!0},{property:"extensions.zeobvQuote.expiryDate",label:"zeobv-quotations.list.columnExpiryDate",allowResize:!0}]},getVariantFromQuotationState:function(e){return this.stateStyleDataProviderService.getStyle("quotation.state",e.extensions.zeobvQuote.stateMachineState.technicalName).variant}}});var l=n("BYeb"),u=n.n(l);Shopware.Component.extend("zeobv-quotations-detail","sw-order-detail",{template:u.a});var c=n("Z8MS"),d=n.n(c),p=Shopware.Component,m=Shopware.Data.Criteria;p.extend("zeobv-quotations-detail-base","sw-order-detail-base",{template:d.a,inject:["stateMachineService","repositoryFactory","orderStateMachineService"],data:function(){return{quotationOptions:[],showModal:!1}},computed:{orderCriteria:function(){var e=this.$super.apply(this,["orderCriteria"].concat(Array.prototype.slice.call(arguments)));return e.addAssociation("zeobvQuote"),e},stateMachineStateCriteria:function(){var e=new m;return e.addSorting({field:"name",order:"ASC"}),e.addAssociation("stateMachine"),e.addFilter(m.equalsAny("state_machine_state.stateMachine.technicalName",["quotation.state"])),e},quotationOptionPlaceholder:function(){return this.isLoading?null:"".concat(this.$tc("zeobv-quotations.detail.stateCard.headlineQuotationState"),":             ").concat(this.order.extensions.zeobvQuote.stateMachineState.translated.name)}},methods:{createdComponent:function(){this.$super.apply(this,["createdComponent"].concat(Array.prototype.slice.call(arguments))),this.stateMachineStateRepository=this.repositoryFactory.create("state_machine_state")},reloadEntityData:function(){var e=this;this.$super.apply(this,["reloadEntityData"].concat(Array.prototype.slice.call(arguments))).then((function(){e.getTransitionOptions()}))},loadQuotationStates:function(){return this.stateMachineService.getState("zeobv_quote",this.order.extensions.zeobvQuote.id,{},{},"quotationStateId")},getTransitionOptions:function(){var e=this,t=[this.loadQuotationStates()];return Promise.all([this.getAllStates()].concat(t)).then((function(t){var n=t[0],o=t[1];return e.quotationOptions=e.buildTransitionOptions("order.quotation_state",n,o.data.transitions),Promise.resolve()}))},buildTransitionOptions:function(e,t,n){var o=this,a=t.map((function(e,t){var n={stateName:e.technicalName,id:null,name:e.translated.name,disabled:!0};return o.feature.isActive("FEATURE_NEXT_7530")&&(n.id=t),n}));return a.forEach((function(e){var t=n.filter((function(t){return t.toStateName===e.stateName}));return t.length>=1&&(e.disabled=!1,e.id=t[0].actionName),e})),a},getAllStates:function(){return this.stateMachineStateRepository.search(this.stateMachineStateCriteria)},onQuickQuotationStatusChange:function(e){var t=this;this.orderStateMachineService.transitionQuotationState(this.order.extensions.zeobvQuote.id,e).then((function(){t.$emit("order-state-change")}))}}});var b=n("sofO"),v=n("kWQ6"),h=n("ahGo");Shopware.Module.register("zeobv-quotations",{type:"plugin",name:"Quotations",title:"zeobv-quotations.general.mainMenuItemGeneral",description:"sw-property.general.descriptionTextModule",color:"#ff3d58",icon:"default-shopping-paper-bag-product",snippets:{"de-DE":b,"nl-NL":h,"en-GB":v},routes:{list:{component:"zeobv-quotations-list",path:"list"},detail:{component:"zeobv-quotations-detail",path:"detail/:id",redirect:{name:"zeobv.quotations.detail.base"},meta:{privilege:"order.viewer",appSystem:{view:"detail"}},children:{base:{component:"zeobv-quotations-detail-base",path:"base",meta:{parentPath:"zeobv.quotations.detail",privilege:"order.viewer"}}},props:{default:function(e){return{orderId:e.params.id}}}}},navigation:[{label:"zeobv-quotations.general.mainMenuItemGeneral",parent:"sw-order",color:"#ff3d58",path:"zeobv.quotations.list",icon:"default-shopping-paper-bag-product",position:100}]});n("8cLR");Shopware.Application.$container.resetProviders(),Shopware.Application.addServiceProviderDecorator("orderStateMachineService",(function(e){return e.transitionQuotationState=function(t,n){var o="_action/zeobv_quote/".concat(t,"/state/").concat(n),a=e.getBasicHeaders();return e.httpClient.post(o,{},{headers:a})},e}))},"8cLR":function(e,t){function n(e,t,n,o,a,r,i){try{var s=e[r](i),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(o,a)}var o=Shopware.Component,a=Shopware.Data.Criteria;o.override("sw-order-list",{methods:{getList:function(){var e,t=this;return(e=regeneratorRuntime.mark((function e(){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.isLoading=!0,e.next=3,Shopware.Service("filterService").mergeWithStoredFilters(t.storeKey,t.orderCriteria);case 3:return n=e.sent,t.activeFilterNumber=n.filters.length,n.addAssociation("zeobvQuote"),n.addFilter(a.multi("OR",[a.equals("order.extensions.zeobvQuote.id",null),a.equals("order.extensions.zeobvQuote.stateMachineState.technicalName","accepted")])),e.prev=7,e.next=10,t.orderRepository.search(n);case 10:o=e.sent,t.total=o.total,t.orders=o,t.isLoading=!1,e.next=19;break;case 16:e.prev=16,e.t0=e.catch(7),t.isLoading=!1;case 19:case"end":return e.stop()}}),e,null,[[7,16]])})),function(){var t=this,o=arguments;return new Promise((function(a,r){var i=e.apply(t,o);function s(e){n(i,a,r,s,l,"next",e)}function l(e){n(i,a,r,s,l,"throw",e)}s(void 0)}))})()}}})},BYeb:function(e,t){e.exports='{% block sw_order_detail_base_status_card %}\n    <zeobv-quotation-state-history-card\n        v-if="!isEditing"\n        ref="state-card"\n        :title="$tc(\'sw-order.stateCard.cardTitle\')"\n        :isLoading="isLoading"\n        :order="order"\n        @order-state-change="reloadEntityData"\n        @options-change="onStateTransitionOptionsChanged">\n    </zeobv-quotation-state-history-card>\n{% endblock %}\n'},UN1d:function(e,t){e.exports='{% block sw_order_list_smart_bar_header_title_text %}\n    {{ $tc(\'zeobv-quotations.general.mainMenuItemGeneral\') }}\n{% endblock %}\n\n{% block sw_order_list_smart_bar_actions_add %}{% endblock %}\n\n{% block sw_order_list_grid_columns_order_number %}\n    <template #column-extensions.zeobvQuote.quoteNumber="{ item }">\n        {% block sw_order_list_grid_order_number_link %}\n            <router-link :to="{ name: \'zeobv.quotations.detail\', params: { id: item.id } }">\n                {{ item.extensions.zeobvQuote.quoteNumber }}\n            </router-link>\n        {% endblock %}\n    </template>\n{% endblock %}\n\n{% block sw_order_list_grid_columns_state %}\n    <template #column-extensions.zeobvQuote.stateMachineState.name="{ item }">\n        <sw-label :variant="getVariantFromQuotationState(item)" appearance="pill">\n            {{ item.extensions.zeobvQuote.stateMachineState.translated.name }}\n        </sw-label>\n    </template>\n{% endblock %}\n\n{% block sw_order_list_grid_columns_actions_view %}\n    <sw-context-menu-item class="sw-order-list__order-view-action" :routerLink="{ name: \'zeobv.quotations.detail\', params: { id: item.id } }">\n        {{ $tc(\'sw-order.list.contextMenuView\') }}\n    </sw-context-menu-item>\n{% endblock %}\n'},Z8MS:function(e,t){e.exports='{% block sw_order_detail_base_status_change_transaction %}\n    <sw-order-state-select\n        v-if="!isLoading"\n        v-tooltip="{\n                        message: $tc(\'sw-privileges.tooltip.warning\'),\n                        disabled: acl.can(\'order.editor\'),\n                        showOnDisabledElements: true\n                    }"\n        class="sw-order-state-select__quotation-state"\n        roundedStyle\n        :transitionOptions="quotationOptions"\n        :placeholder="quotationOptionPlaceholder"\n        @state-select="onQuickQuotationStatusChange">\n    </sw-order-state-select>\n{% endblock %}\n\n{% block sw_order_detail_base_status_change_delivery %}{% endblock %}\n\n{% block sw_order_detail_base_status_change_order %}{% endblock %}\n\n{% block sw_order_detail_base_status_card %}{% endblock %}\n\n{% block sw_order_detail_base_document_grid %}{% endblock %}\n'},ahGo:function(e){e.exports=JSON.parse('{"zeobv-quotations":{"general":{"mainMenuItemGeneral":"Offertes"},"list":{"columnQuoteNumber":"Offerte nummer","columnState":"Offerte status","columnExpiryDate":"Vervals datum"}}}')},kWQ6:function(e){e.exports=JSON.parse('{"zeobv-quotations":{"general":{"mainMenuItemGeneral":"Quotations"},"list":{"columnQuoteNumber":"Quote number","columnState":"Quote state","columnExpiryDate":"Expiry date"},"detail":{"stateCard":{"headlineQuotationState":"Quotation status"}}}}')},sofO:function(e){e.exports=JSON.parse('{"zeobv-quotations":{"general":{"mainMenuItemGeneral":"Angebote"},"list":{"columnQuoteNumber":"Angebotsnummer","columnState":"Angebotsstatus","columnExpiryDate":"Verfallsdatum"}}}')}});